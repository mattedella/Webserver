
worker_processes  2;
pid /var/run/nginx.pid;
error_log  /var/log/nginx.error_log  info;

events {
    worker_connections   1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    
    access_log   /var/log/nginx.access_log main;

    client_max_body_size 10m;
    client_body_buffer_size 128k;

    client_header_timeout 3m;
    client_body_timeout 3m;
    send_timeout 3m;

    server {
        listen localhost:80;
        server_name DreamTeam.com www.DreamTeam.com;

        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;

        location = /404.html {
            root /var/www/html;
        }

        location = /50x.html {
            root /var/www/html;
        }

        location / {
            root /var/www/html;
            index index.html;
            try_files $uri $uri/ =404;
        }

        client_max_body_size 5m;

        location /api {
            limit_except GET POST {
                deny all;
            }
            root /var/www/api;
        }

        location /old-route {
            return 301 /new-route;
        }

        location /files {
            autoindex off;
            root /var/www/files;
        }

        location /public {
            autoindex on;
            root /var/www/public;
        }

        location /docs {
            root /var/www/docs;
            index index.html;
        }

        location ~ \.php$ {
            root /var/www/html;
            fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
            fastcgi_index index.php;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            include fastcgi_params;
        }

        location /upload {
            root /var/www/uploads;
            client_max_body_size 50m;
            client_body_buffer_size 1m;
            client_body_temp_path /tmp/nginx_uploads;
            upload_pass @upload_backend;
        }

        location @upload_backend {
            proxy_pass http://backend-upload-server;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }

    server {
        listen localhost:8080;
        server_name Team2.com www.Team2.com;

        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;

        location = /404.html {
            root /var/www/html;
        }

        location = /50x.html {
            root /var/www/html;
        }

        location / {
            root /var/www/another;
            index index.html;
            try_files $uri $uri/ =404;
        }

        client_max_body_size 10m;

        location /readonly-api {
            limit_except GET {
                deny all;
            }
            root /var/www/api;
        }

        location /images {
            autoindex on;
            root /var/www/another/images;
        }

        location /about {
            root /var/www/about;
            index index.html;
        }

        location ~ \.php$ {
            root /var/www/another;
            fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
            fastcgi_index index.php;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            include fastcgi_params;
        }

        location /uploads {
            root /var/www/uploads;
            client_max_body_size 100m;
            client_body_buffer_size 2m;
            client_body_temp_path /tmp/nginx_uploads;
            upload_pass @upload_backend;
        }

        location @upload_backend {
            proxy_pass http://backend-upload-server;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}




